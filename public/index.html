<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MiniMax Video Generator - Test Interface</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell,
          sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .header {
        text-align: center;
        color: white;
        margin-bottom: 40px;
      }

      .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
      }

      .header p {
        font-size: 1.1em;
        opacity: 0.9;
      }

      .tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 30px;
        flex-wrap: wrap;
      }

      .tab {
        padding: 12px 24px;
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        cursor: pointer;
        border-radius: 8px;
        font-size: 16px;
        transition: all 0.3s;
      }

      .tab:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      .tab.active {
        background: white;
        color: #667eea;
        font-weight: 600;
      }

      .tab-content {
        display: none;
        background: white;
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      }

      .tab-content.active {
        display: block;
        animation: fadeIn 0.3s;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #333;
      }

      .form-group input,
      .form-group textarea,
      .form-group select {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 15px;
        transition: border-color 0.3s;
      }

      .form-group input[type='file'] {
        padding: 10px;
        background: #f8f9fa;
        cursor: pointer;
      }

      .form-group input[type='file']::-webkit-file-upload-button {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        margin-right: 10px;
      }

      .form-group input[type='file']::-webkit-file-upload-button:hover {
        opacity: 0.9;
      }

      .form-group input:focus,
      .form-group textarea:focus,
      .form-group select:focus {
        outline: none;
        border-color: #667eea;
      }

      .form-group textarea {
        min-height: 120px;
        resize: vertical;
        font-family: inherit;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }

      .btn {
        padding: 14px 32px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition:
          transform 0.2s,
          box-shadow 0.2s;
        width: 100%;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
      }

      .btn:active {
        transform: translateY(0);
      }

      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .result {
        margin-top: 30px;
        padding: 20px;
        background: #f5f5f5;
        border-radius: 8px;
        display: none;
      }

      .result.show {
        display: block;
        animation: fadeIn 0.3s;
      }

      .result h3 {
        margin-bottom: 15px;
        color: #333;
      }

      .result pre {
        background: #2d2d2d;
        color: #f8f8f2;
        padding: 15px;
        border-radius: 6px;
        overflow-x: auto;
        font-size: 14px;
      }

      .alert {
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
      }

      .alert-success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .alert-error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .alert-info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }

      .loading {
        display: none;
        text-align: center;
        padding: 20px;
      }

      .loading.show {
        display: block;
      }

      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 15px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .hint {
        font-size: 13px;
        color: #666;
        margin-top: 5px;
      }

      .camera-commands {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 6px;
        margin-bottom: 20px;
      }

      .camera-commands h4 {
        margin-bottom: 10px;
        color: #333;
      }

      .camera-commands code {
        background: #e9ecef;
        padding: 2px 6px;
        border-radius: 3px;
        font-size: 13px;
      }

      .examples {
        background: #fff3cd;
        padding: 15px;
        border-radius: 6px;
        margin-top: 15px;
      }

      .examples h4 {
        margin-bottom: 10px;
        color: #856404;
      }

      .examples ul {
        margin-left: 20px;
      }

      .examples li {
        margin-bottom: 5px;
        color: #856404;
      }

      /* Tasks Management Styles */
      .tasks-container {
        margin-top: 20px;
      }

      .tasks-filters {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
      }

      .tasks-list {
        margin-top: 20px;
      }

      .task-card {
        background: white;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
        transition: all 0.3s;
      }

      .task-card:hover {
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .task-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .task-type {
        background: #e9ecef;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        color: #495057;
      }

      .task-status {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 600;
      }

      .task-status.processing {
        background: #cff4fc;
        color: #055160;
      }

      .task-status.success {
        background: #d1e7dd;
        color: #0f5132;
      }

      .task-status.failed {
        background: #f8d7da;
        color: #842029;
      }

      .task-progress {
        height: 4px;
        background: #e9ecef;
        border-radius: 2px;
        margin: 10px 0;
        overflow: hidden;
      }

      .task-progress-bar {
        height: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        width: 0%;
        transition: width 0.3s;
      }

      .tasks-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 30px;
      }

      .stat-card {
        background: white;
        padding: 20px;
        border-radius: 8px;
        text-align: center;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .stat-card h4 {
        color: #495057;
        margin-bottom: 10px;
        font-size: 14px;
      }

      .stat-value {
        font-size: 24px;
        font-weight: 600;
        color: #667eea;
      }

      /* Pricing Styles */
      .pricing-section {
        background: white;
        border-radius: 12px;
        padding: 25px;
        margin-bottom: 30px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .pricing-section h3 {
        margin-bottom: 20px;
        color: #333;
        font-size: 1.3em;
      }

      .pricing-table {
        width: 100%;
        border-radius: 8px;
        overflow: hidden;
        border: 1px solid #e0e0e0;
      }

      .pricing-row {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        padding: 12px 20px;
        align-items: center;
      }

      .pricing-row:not(:last-child) {
        border-bottom: 1px solid #e0e0e0;
      }

      .pricing-row.header {
        background: #f8f9fa;
        font-weight: 600;
        color: #495057;
      }

      .pricing-row:not(.header):hover {
        background: #f8f9fa;
      }

      .pricing-note {
        margin-top: 10px;
        font-size: 0.9em;
        color: #666;
      }

      /* TTS Styles */
      .range-value {
        text-align: center;
        font-size: 14px;
        color: #666;
        margin-top: 5px;
      }

      input[type='range'] {
        width: 100%;
        height: 8px;
        border-radius: 4px;
        background: #e0e0e0;
        outline: none;
        -webkit-appearance: none;
      }

      input[type='range']::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        cursor: pointer;
        border: 2px solid white;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      }

      #audioPreview {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-top: 20px;
      }

      #audioPreview audio {
        width: 100%;
        margin-top: 10px;
      }

      /* Add price indicators to forms */
      .price-indicator {
        display: inline-block;
        background: #e9ecef;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.9em;
        color: #495057;
        margin-left: 10px;
      }

      /* Dark theme support */
      @media (prefers-color-scheme: dark) {
        .task-card {
          background: #2d2d2d;
          border-color: #404040;
        }

        .task-type {
          background: #404040;
          color: #e0e0e0;
        }

        .stat-card {
          background: #2d2d2d;
        }

        .stat-card h4 {
          color: #e0e0e0;
        }

        .tasks-filters {
          background: #2d2d2d;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>🎥 MiniMax Video Generator</h1>
        <p>Тестовый интерфейс для генерации видео через Hailuo API</p>
      </div>

      <div class="tabs">
        <button class="tab active" data-tab="t2v">📝 Text to Video</button>
        <button class="tab" data-tab="i2v">🖼️ Image to Video</button>
        <button class="tab" data-tab="start-end">🎬 Start & End Frames</button>
        <button class="tab" data-tab="t2i">🎨 Text to Image</button>
        <button class="tab" data-tab="demo">⚡ Quick Demo</button>
        <button class="tab" data-tab="tasks">📋 Задачи</button>
        <button class="tab" data-tab="pricing">💰 Цены</button>
        <button class="tab" data-tab="tts">🎧 Text to Speech</button>
        <button class="tab" data-tab="voice-clone">🎤 Voice Clone</button>
        <button class="tab" data-tab="templates">📽️ Video Templates</button>
        <button class="tab" data-tab="shorts">⚡ Generate Short</button>
      </div>

      <!-- Text to Speech -->
      <div id="tts" class="tab-content">
        <div class="alert alert-info" style="margin-bottom: 20px">
          <strong>🎧 Синтез речи</strong><br />
          Преобразование текста в естественную речь с поддержкой 40 языков.
        </div>

        <form id="ttsForm">
          <div class="form-group">
            <label>Текст для озвучивания</label>
            <textarea
              name="text"
              required
              placeholder="Введите текст для озвучивания..."
            ></textarea>
            <div class="hint">
              До 10,000 символов для синхронного режима, до 1М для асинхронного.
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Модель</label>
              <select name="model">
                <option value="speech-2.5-hd-preview">HD Preview (Высокое качество)</option>
                <option value="speech-2.5-turbo-preview">Turbo Preview (40 языков)</option>
                <option value="speech-02-hd">HD (Стабильная)</option>
                <option value="speech-02-turbo">Turbo (Стабильная)</option>
              </select>
            </div>

            <div class="form-group">
              <label>Голос</label>
              <select name="voice_id">
                <option value="English_expressive_narrator">English Narrator</option>
                <option value="Russian_expressive_narrator">Russian Narrator</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Скорость речи</label>
              <input type="range" name="speed" min="0.5" max="2.0" step="0.1" value="1.0" />
              <div class="range-value">1.0</div>
            </div>

            <div class="form-group">
              <label>Громкость</label>
              <input type="range" name="volume" min="0.1" max="2.0" step="0.1" value="1.0" />
              <div class="range-value">1.0</div>
            </div>
          </div>

          <div class="form-group">
            <label>Эффекты</label>
            <select name="sound_effects">
              <option value="none">Без эффектов</option>
              <option value="spacious_echo">Пространственное эхо</option>
              <option value="warm_echo">Теплое эхо</option>
            </select>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Формат аудио</label>
              <select name="format">
                <option value="mp3">MP3</option>
                <option value="wav">WAV</option>
              </select>
            </div>

            <div class="form-group">
              <label>Режим</label>
              <select name="mode">
                <option value="sync">Синхронный (до 10К символов)</option>
                <option value="async">Асинхронный (до 1М символов)</option>
              </select>
            </div>
          </div>

          <button type="submit" class="btn">🎧 Сгенерировать аудио</button>
        </form>

        <div class="loading" id="ttsLoading">
          <div class="spinner"></div>
          <p>Генерация аудио...</p>
        </div>

        <div class="result" id="ttsResult"></div>

        <!-- Preview Player -->
        <div id="audioPreview" style="display: none; margin-top: 20px">
          <h3>🎵 Предпросмотр:</h3>
          <audio controls style="width: 100%; margin-top: 10px"></audio>
        </div>
      </div>

      <!-- Pricing -->
      <div id="pricing" class="tab-content">
        <div class="alert alert-info" style="margin-bottom: 20px">
          <strong>💰 Стоимость генерации</strong><br />
          Актуальные цены на использование MiniMax API.
        </div>

        <div class="pricing-section">
          <h3>🎥 Генерация видео</h3>
          <div class="pricing-table">
            <div class="pricing-row header">
              <div>Разрешение</div>
              <div>Длительность</div>
              <div>Цена</div>
            </div>
            <div class="pricing-row">
              <div>512P</div>
              <div>6 секунд</div>
              <div>$0.10</div>
            </div>
            <div class="pricing-row">
              <div>512P</div>
              <div>10 секунд</div>
              <div>$0.15</div>
            </div>
            <div class="pricing-row">
              <div>768P</div>
              <div>6 секунд</div>
              <div>$0.28</div>
            </div>
            <div class="pricing-row">
              <div>768P</div>
              <div>10 секунд</div>
              <div>$0.56</div>
            </div>
            <div class="pricing-row">
              <div>1080P</div>
              <div>6 секунд</div>
              <div>$0.49</div>
            </div>
          </div>
          <div class="pricing-note">* Цены указаны за один видеоролик через MiniMax-Hailuo-02</div>
        </div>

        <div class="pricing-section">
          <h3>🎨 Генерация изображений</h3>
          <div class="pricing-table">
            <div class="pricing-row header">
              <div>Модель</div>
              <div>Тип</div>
              <div>Цена</div>
            </div>
            <div class="pricing-row">
              <div>image-01</div>
              <div>Одно изображение</div>
              <div>$0.0035</div>
            </div>
          </div>
        </div>

        <div class="alert alert-info" style="margin-top: 20px">
          <strong>ℹ️ Дополнительная информация:</strong>
          <ul style="margin-top: 10px">
            <li>Цены могут изменяться в зависимости от курса и тарифов MiniMax</li>
            <li>При генерации видео учитывайте соотношение качество/цена</li>
            <li>Для больших объемов рекомендуется использовать 768P вместо 1080P</li>
            <li>При генерации изображений можно создавать несколько вариантов за один запрос</li>
          </ul>
        </div>
      </div>

      <!-- Tasks Management -->
      <div id="tasks" class="tab-content">
        <div class="alert alert-info" style="margin-bottom: 20px">
          <strong>📋 Управление задачами</strong><br />
          Просмотр и управление всеми задачами генерации.
        </div>

        <div class="tasks-container">
          <div class="tasks-filters">
            <div class="form-row">
              <div class="form-group">
                <label>Статус</label>
                <select id="taskStatusFilter">
                  <option value="all">Все задачи</option>
                  <option value="processing">В процессе</option>
                  <option value="success">Завершенные</option>
                  <option value="failed">С ошибками</option>
                </select>
              </div>
              <div class="form-group">
                <label>Тип</label>
                <select id="taskTypeFilter">
                  <option value="all">Все типы</option>
                  <option value="t2v">Text to Video</option>
                  <option value="i2v">Image to Video</option>
                  <option value="start-end">Start & End</option>
                  <option value="t2i">Text to Image</option>
                </select>
              </div>
            </div>
          </div>

          <div class="tasks-list" id="tasksList">
            <!-- Tasks will be populated here -->
          </div>
        </div>

        <div class="tasks-stats">
          <div class="stat-card">
            <h4>Активные задачи</h4>
            <div class="stat-value" id="activeTasksCount">0</div>
          </div>
          <div class="stat-card">
            <h4>Завершено сегодня</h4>
            <div class="stat-value" id="completedTodayCount">0</div>
          </div>
          <div class="stat-card">
            <h4>Ошибок сегодня</h4>
            <div class="stat-value" id="failedTodayCount">0</div>
          </div>
        </div>
      </div>

      <!-- Text to Video -->
      <div id="t2v" class="tab-content active">
        <div class="camera-commands">
          <h4>💡 Команды камеры:</h4>
          <p>
            <code>[Push in]</code> <code>[Pull out]</code> <code>[Pan left]</code>
            <code>[Pan right]</code> <code>[Tilt up]</code> <code>[Tilt down]</code>
            <code>[Zoom in]</code> <code>[Zoom out]</code> <code>[Tracking shot]</code>
            <code>[Static shot]</code>
          </p>
        </div>

        <form id="t2vForm">
          <div class="form-group">
            <label>Промпт (описание видео)</label>
            <textarea
              name="prompt"
              required
              placeholder="Например: A golden retriever puppy playing in the park [Push in] then running towards camera [Tracking shot]"
            >
A cute cat sitting on a windowsill, watching birds outside [Pan right,Zoom in]</textarea
            >
            <div class="hint">
              Максимум 2000 символов. Используйте команды камеры для управления движением.
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Длительность (секунд)</label>
              <select name="duration">
                <option value="6">6 секунд</option>
                <option value="10">10 секунд (только 768P/512P)</option>
              </select>
            </div>

            <div class="form-group">
              <label>Разрешение</label>
              <select name="resolution" onchange="updatePriceIndicator(this)">
                <option value="1080P" data-price="0.49">1080P (высокое качество)</option>
                <option value="768P" data-price="0.28">768P (оптимально)</option>
                <option value="512P" data-price="0.10">512P (быстро)</option>
              </select>
              <div class="price-indicator">💰 $0.49</div>
            </div>
          </div>

          <div class="form-group">
            <label>Формат видео</label>
            <select name="aspect_ratio">
              <option value="16:9">🖥️ Горизонтальное (16:9)</option>
              <option value="9:16">📱 Вертикальное (9:16)</option>
              <option value="1:1">⬛ Квадратное (1:1)</option>
            </select>
          </div>

          <button type="submit" class="btn">🚀 Сгенерировать видео</button>
        </form>

        <div class="loading" id="t2vLoading">
          <div class="spinner"></div>
          <p>Отправка запроса...</p>
        </div>

        <div class="result" id="t2vResult"></div>
      </div>

      <!-- Image to Video -->
      <div id="i2v" class="tab-content">
        <div class="form-group">
          <label>Выберите изображение</label>
          <input
            type="file"
            id="i2vImageFile"
            accept="image/jpeg,image/png,image/webp"
            style="margin-bottom: 10px"
          />
          <div class="hint">Форматы: JPG, PNG, WebP. Размер < 20MB. Короткая сторона > 300px.</div>
          <div style="margin-top: 15px; text-align: center" id="i2vPreview"></div>
        </div>

        <div style="text-align: center; margin: 15px 0; color: #999">или</div>

        <div class="form-group">
          <label>URL изображения</label>
          <input
            type="url"
            id="i2vImage"
            placeholder="https://example.com/image.jpg"
            value="https://filecdn.minimax.chat/public/fe9d04da-f60e-444d-a2e0-18ae743add33.jpeg"
          />
        </div>

        <form id="i2vForm">
          <div class="form-group">
            <label>Промпт (описание движения)</label>
            <textarea
              name="prompt"
              placeholder="Например: The mouse blinks, smiles, and runs toward the camera [Pedestal up,Push in]"
            >
The character smiles and waves at the camera [Tilt up,Zoom in]</textarea
            >
            <div class="hint">Опционально. Описывает, как должно двигаться изображение.</div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Длительность (секунд)</label>
              <select name="duration">
                <option value="6">6 секунд</option>
                <option value="10">10 секунд</option>
              </select>
            </div>

            <div class="form-group">
              <label>Разрешение</label>
              <select name="resolution">
                <option value="1080P">1080P</option>
                <option value="768P">768P</option>
                <option value="512P">512P</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>Формат видео</label>
            <select name="aspect_ratio">
              <option value="16:9">🖥️ Горизонтальное (16:9)</option>
              <option value="9:16">📱 Вертикальное (9:16)</option>
              <option value="1:1">⬛ Квадратное (1:1)</option>
            </select>
          </div>

          <button type="submit" class="btn">🚀 Анимировать изображение</button>
        </form>

        <div class="loading" id="i2vLoading">
          <div class="spinner"></div>
          <p>Отправка запроса...</p>
        </div>

        <div class="result" id="i2vResult"></div>
      </div>

      <!-- Start & End Frames -->
      <div id="start-end" class="tab-content">
        <div class="form-row">
          <div class="form-group">
            <label>Первый кадр</label>
            <input
              type="file"
              id="startImageFile"
              accept="image/jpeg,image/png,image/webp"
              style="margin-bottom: 10px"
            />
            <div style="margin-top: 10px; text-align: center" id="startPreview"></div>
            <div style="text-align: center; margin: 10px 0; color: #999; font-size: 12px">или</div>
            <input
              type="url"
              id="startImage"
              placeholder="https://example.com/start.jpg"
              value="https://filecdn.minimax.chat/public/fe9d04da-f60e-444d-a2e0-18ae743add33.jpeg"
            />
          </div>

          <div class="form-group">
            <label>Последний кадр</label>
            <input
              type="file"
              id="endImageFile"
              accept="image/jpeg,image/png,image/webp"
              style="margin-bottom: 10px"
            />
            <div style="margin-top: 10px; text-align: center" id="endPreview"></div>
            <div style="text-align: center; margin: 10px 0; color: #999; font-size: 12px">или</div>
            <input
              type="url"
              id="endImage"
              placeholder="https://example.com/end.jpg"
              value="https://filecdn.minimax.chat/public/97b7cd08-764e-4b8b-a7bf-87a0bd898575.jpeg"
            />
          </div>
        </div>

        <form id="startEndForm">
          <div class="form-group">
            <label>Промпт (описание перехода)</label>
            <textarea
              name="prompt"
              placeholder="Например: Smooth transition from childhood to adulthood [Pan right,Pedestal up]"
            >
A smooth transition between the two scenes [Pan right,Zoom in]</textarea
            >
            <div class="hint">Опционально. Описывает переход между кадрами.</div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Длительность (секунд)</label>
              <select name="duration">
                <option value="6">6 секунд</option>
                <option value="10">10 секунд (только 768P)</option>
              </select>
            </div>

            <div class="form-group">
              <label>Разрешение</label>
              <select name="resolution">
                <option value="1080P">1080P</option>
                <option value="768P">768P</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>Формат видео</label>
            <select name="aspect_ratio">
              <option value="16:9">🖥️ Горизонтальное (16:9)</option>
              <option value="9:16">📱 Вертикальное (9:16)</option>
              <option value="1:1">⬛ Квадратное (1:1)</option>
            </select>
          </div>

          <button type="submit" class="btn">🚀 Создать переход</button>
        </form>

        <div class="loading" id="startEndLoading">
          <div class="spinner"></div>
          <p>Отправка запроса...</p>
        </div>

        <div class="result" id="startEndResult"></div>
      </div>

      <!-- Text to Image -->
      <div id="t2i" class="tab-content">
        <div class="alert alert-info" style="margin-bottom: 20px">
          <strong>🎨 Генерация изображений</strong><br />
          Создавайте высококачественные изображения из текстовых описаний. Поддерживается множество
          форматов и разрешений.
        </div>

        <form id="t2iForm">
          <div class="form-group">
            <label>Промпт (описание изображения)</label>
            <textarea
              name="prompt"
              required
              placeholder="Например: A serene mountain landscape at sunset with vibrant orange and purple sky, photorealistic, 8k"
            >
A man in a white t-shirt, full-body, standing front view, outdoors, with the Venice Beach sign in the background, Los Angeles. Fashion photography in 90s documentary style, film grain, photorealistic.</textarea
            >
            <div class="hint">
              Максимум 1500 символов. Будьте детальны и конкретны для лучших результатов.
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Формат изображения</label>
              <select name="aspect_ratio">
                <option value="1:1">⬛ Квадрат (1:1) - 1024x1024</option>
                <option value="16:9">🖥️ Широкий (16:9) - 1280x720</option>
                <option value="4:3">📺 Стандартный (4:3) - 1152x864</option>
                <option value="3:2">📷 Фото (3:2) - 1248x832</option>
                <option value="2:3">📱 Портрет (2:3) - 832x1248</option>
                <option value="3:4">📱 Портрет+ (3:4) - 864x1152</option>
                <option value="9:16">📱 Вертикальный (9:16) - 720x1280</option>
                <option value="21:9">🎬 Ультраширокий (21:9) - 1344x576</option>
              </select>
            </div>

            <div class="form-group">
              <label>Количество изображений</label>
              <select name="n">
                <option value="1">1 изображение</option>
                <option value="2">2 изображения</option>
                <option value="3" selected>3 изображения</option>
                <option value="4">4 изображения</option>
                <option value="5">5 изображений</option>
                <option value="6">6 изображений</option>
                <option value="9">9 изображений</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Seed (для воспроизводимости)</label>
              <input type="number" name="seed" placeholder="Оставьте пустым для случайного" />
              <div class="hint">
                Одинаковый seed создаёт одинаковые изображения при тех же параметрах
              </div>
            </div>

            <div class="form-group">
              <label>Оптимизация промпта</label>
              <select name="prompt_optimizer">
                <option value="false">Выключена (точный промпт)</option>
                <option value="true">Включена (AI улучшает промпт)</option>
              </select>
            </div>
          </div>

          <button type="submit" class="btn">🎨 Сгенерировать изображения</button>
        </form>

        <div class="loading" id="t2iLoading">
          <div class="spinner"></div>
          <p>Генерация изображений...</p>
        </div>

        <div class="result" id="t2iResult"></div>
      </div>

      <!-- Quick Demo -->
      <div id="demo" class="tab-content">
        <div class="alert alert-info">
          <strong>ℹ️ Быстрое тестирование</strong><br />
          Эти эндпоинты используют предустановленные параметры для быстрого тестирования API.
        </div>

        <div class="form-group">
          <button class="btn demo-btn" data-demo="t2i" style="margin-bottom: 15px">
            🎨 Demo: Text to Image (японский сад)
          </button>
          <button class="btn demo-btn" data-demo="t2v" style="margin-bottom: 15px">
            📝 Demo: Text to Video (щенок у прилавка)
          </button>
          <button class="btn demo-btn" data-demo="i2v" style="margin-bottom: 15px">
            🖼️ Demo: Image to Video (мышка бежит)
          </button>
          <button class="btn demo-btn" data-demo="start-end">
            🎬 Demo: Start & End (девочка растет)
          </button>
        </div>

        <div class="examples">
          <h4>📚 Примеры промптов:</h4>
          <ul>
            <li>A corgi pranks his friend, then redeems himself [Tracking shot]</li>
            <li>Beautiful sunset over mountains [Pan right,Pedestal down]</li>
            <li>A dancer spins gracefully [Push in], then bows [Static shot]</li>
            <li>A cat jumps on the table [Pan left,Pedestal up]</li>
          </ul>
        </div>

        <div class="loading" id="demoLoading">
          <div class="spinner"></div>
          <p>Отправка запроса...</p>
        </div>

        <div class="result" id="demoResult"></div>
      </div>

      <!-- Voice Clone -->
      <div id="voice-clone" class="tab-content">
        <div class="alert alert-info" style="margin-bottom: 20px">
          <strong>🎤 Клонирование голоса</strong><br />
          Создайте собственный уникальный голос на основе аудиозаписи. Поддерживаются mp3, m4a, wav
          форматы.
        </div>

        <form id="voiceCloneForm">
          <div class="form-group">
            <label
              >Исходное аудио для клонирования
              <span class="hint">(10 сек - 5 мин, до 20 МБ)</span></label
            >
            <input type="file" name="sourceAudio" accept=".mp3,.m4a,.wav" required />
            <div class="hint">Загрузите аудиозапись голоса, который хотите клонировать.</div>
          </div>

          <div class="form-group">
            <label>Пример аудио <span class="hint">(опционально, до 8 сек)</span></label>
            <input type="file" name="promptAudio" accept=".mp3,.m4a,.wav" />
            <div class="hint">Короткий пример для улучшения качества клонирования.</div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>ID голоса</label>
              <input type="text" name="voiceId" placeholder="my_custom_voice_1" required />
              <div class="hint">Уникальный идентификатор для дальнейшего использования.</div>
            </div>

            <div class="form-group">
              <label>Модель</label>
              <select name="model">
                <option value="speech-2.5-hd-preview">HD Preview (Высокое качество)</option>
                <option value="speech-02-hd">HD (Стабильная)</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>Описание голоса (для улучшения клонирования)</label>
            <textarea
              name="promptText"
              placeholder="Например: Это приятный детский голос с мягкими интонациями..."
            >
Это естественный и приятный голос.</textarea
            >
          </div>

          <div class="form-group">
            <label>Тестовый текст</label>
            <textarea name="text" required>
Легкий ветерок проносится над мягкой травой, принося с собой свежий аромат и пение птиц.</textarea
            >
            <div class="hint">Этот текст будет озвучен клонированным голосом для проверки.</div>
          </div>

          <button type="submit" class="btn">🎤 Клонировать голос</button>
        </form>

        <div class="loading" id="voiceCloneLoading">
          <div class="spinner"></div>
          <p>Клонирование голоса...</p>
        </div>

        <div class="result" id="voiceCloneResult"></div>

        <!-- Preview Players -->
        <div id="clonePreview" style="display: none; margin-top: 20px">
          <div style="margin-bottom: 20px">
            <h3>🎵 Исходное аудио:</h3>
            <audio controls style="width: 100%; margin-top: 10px" id="sourcePreview"></audio>
          </div>

          <div style="margin-bottom: 20px">
            <h3>🎵 Пример аудио:</h3>
            <audio controls style="width: 100%; margin-top: 10px" id="promptPreview"></audio>
          </div>

          <div>
            <h3>🎵 Результат клонирования:</h3>
            <audio controls style="width: 100%; margin-top: 10px" id="resultPreview"></audio>
          </div>
        </div>
      </div>

      <!-- Video Templates -->
      <div id="templates" class="tab-content">
        <div class="alert alert-info" style="margin-bottom: 20px">
          <strong>📽️ Видео из шаблонов</strong><br />
          Создавайте профессиональные видео на основе готовых шаблонов, настраивая текст,
          изображения и другие элементы.
        </div>

        <!-- Template Browser -->
        <div class="form-group" style="margin-bottom: 30px">
          <label>Доступные шаблоны</label>
          <div
            id="templateGallery"
            style="
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
              gap: 20px;
              margin-top: 15px;
            "
          >
            <!-- Templates will be loaded here -->
          </div>
        </div>

        <!-- Template Generator Form -->
        <form id="templateForm" style="display: none">
          <div class="alert alert-info">
            <strong>ℹ️ Выбран шаблон:</strong>
            <span id="selectedTemplateName">Нет</span>
          </div>

          <div id="templateInputs">
            <!-- Dynamic inputs will be added here based on template -->
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Разрешение</label>
              <select name="resolution">
                <option value="1080P">1080P (высокое качество)</option>
                <option value="768P">768P (оптимально)</option>
                <option value="512P">512P (быстро)</option>
              </select>
            </div>

            <div class="form-group">
              <label>Приоритет</label>
              <select name="priority">
                <option value="normal">Обычный</option>
                <option value="high">Высокий</option>
              </select>
            </div>
          </div>

          <button type="submit" class="btn">🚀 Создать видео</button>
        </form>

        <!-- Template Preview -->
        <div id="templatePreview" style="display: none; margin-top: 30px">
          <h3>👀 Предпросмотр шаблона:</h3>
          <div style="position: relative; margin-top: 15px">
            <video
              id="previewVideo"
              style="width: 100%; max-width: 600px; border-radius: 8px"
              loop
              muted
            ></video>
            <div
              style="
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                color: white;
                font-size: 48px;
                opacity: 0;
                transition: opacity 0.3s;
              "
              id="playIcon"
            >
              ▶️
            </div>
          </div>
        </div>

        <div class="loading" id="templateLoading">
          <div class="spinner"></div>
          <p>Генерация видео...</p>
        </div>

        <div class="result" id="templateResult"></div>
      </div>

      <!-- 1-click Generate Short -->
      <div id="shorts" class="tab-content">
        <div class="alert alert-info" style="margin-bottom: 20px">
          <strong>⚡ 1-Click Generate Short</strong><br />
          Быстрая генерация короткого видео: сценарий → ассеты → голос → сборка → экспорт.
        </div>

        <form id="shortForm">
          <div class="form-group">
            <label>Тема / Ключевая идея</label>
            <input
              type="text"
              name="topic"
              placeholder="Например: Cute puppy helps at the food stall"
              required
            />
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Язык сценария</label>
              <select name="language">
                <option value="en">English</option>
                <option value="ru">Русский</option>
                <option value="es">Español</option>
              </select>
            </div>

            <div class="form-group">
              <label>Режим</label>
              <select name="mode">
                <option value="t2v">Text → Video (T2V)</option>
                <option value="i2v">Image → Video (I2V)</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Голос (TTS)</label>
              <select name="voice_id">
                <option value="English_expressive_narrator">English (Narrator)</option>
                <option value="Russian_expressive_narrator">Русский (Narrator)</option>
              </select>
            </div>

            <div class="form-group">
              <label>Скорость речи</label>
              <input type="range" name="speed" min="0.7" max="1.6" step="0.1" value="1.0" />
              <div class="range-value">1.0</div>
            </div>
          </div>

          <div class="form-group">
            <label>Длительность каждого бита (сек)</label>
            <select name="beat_duration">
              <option value="5">5</option>
              <option value="6" selected>6</option>
              <option value="8">8</option>
            </select>
          </div>

          <button type="submit" class="btn">⚡ Generate Short</button>
        </form>

        <div class="loading" id="shortsLoading">
          <div class="spinner"></div>
          <p>Выполняется пайплайн...</p>
        </div>

        <div class="result" id="shortsResult"></div>

        <div
          id="shortsLog"
          style="
            margin-top: 16px;
            font-family: monospace;
            font-size: 13px;
            white-space: pre-wrap;
            background: #fff;
            padding: 12px;
            border-radius: 8px;
            display: none;
          "
        ></div>
      </div>
    </div>

    <script src="/js/main.js"></script>
    <script src="/js/tts.js"></script>
    <script src="/js/voice-clone.js"></script>
    <script src="/js/templates.js"></script>
    <script src="/js/shorts.js"></script>

    <script>
      // Declare API_BASE variable
      const API_BASE = 'http://localhost:3000'

      // Templates interaction
      document.addEventListener('DOMContentLoaded', async () => {
        // Initialize template browser
        try {
          const response = await fetch(`${API_BASE}/api/video-templates`)
          const templates = await response.json()
          displayTemplates(templates)
        } catch (error) {
          console.error('Failed to load templates:', error)
        }

        // Setup template preview interactions
        const previewVideo = document.getElementById('previewVideo')
        const playIcon = document.getElementById('playIcon')

        if (previewVideo) {
          previewVideo.addEventListener('mouseover', () => {
            previewVideo.play()
            playIcon.style.opacity = '0'
          })

          previewVideo.addEventListener('mouseout', () => {
            previewVideo.pause()
            playIcon.style.opacity = '1'
          })

          previewVideo.addEventListener('play', () => {
            playIcon.style.opacity = '0'
          })

          previewVideo.addEventListener('pause', () => {
            playIcon.style.opacity = '1'
          })
        }

        // Setup template form submission
        const templateForm = document.getElementById('templateForm')
        if (templateForm) {
          templateForm.addEventListener('submit', handleTemplateSubmit)
        }
      })

      function displayTemplates(templates) {
        const gallery = document.getElementById('templateGallery')
        if (!gallery) return

        gallery.innerHTML = templates
          .map(
            (template) => `
                <div class="template-card" style="border: 1px solid #e0e0e0; border-radius: 8px; overflow: hidden; cursor: pointer;"
                     onclick="selectTemplate('${template.id}')">
                    <div style="position: relative;">
                        <img src="${template.thumbnail}" 
                             alt="${template.name}"
                             style="width: 100%; height: 158px; object-fit: cover;">
                        <div style="position: absolute; bottom: 0; left: 0; right: 0; 
                                  background: rgba(0,0,0,0.7); color: white; padding: 8px;">
                            ${template.name}
                        </div>
                    </div>
                    <div style="padding: 12px;">
                        <p style="margin: 0; font-size: 14px; color: #666;">
                            ${template.description}
                        </p>
                    </div>
                </div>
            `
          )
          .join('')
      }

      async function selectTemplate(templateId) {
        try {
          const response = await fetch(`${API_BASE}/api/video-templates/${templateId}`)
          const template = await response.json()

          // Show template form
          const templateForm = document.getElementById('templateForm')
          templateForm.style.display = 'block'

          // Update template name
          document.getElementById('selectedTemplateName').textContent = template.name

          // Generate input fields
          const inputsContainer = document.getElementById('templateInputs')
          inputsContainer.innerHTML = generateInputFields(template.inputs)

          // Setup preview
          const previewContainer = document.getElementById('templatePreview')
          const previewVideo = document.getElementById('previewVideo')

          previewContainer.style.display = 'block'
          previewVideo.src = template.preview_url
          previewVideo.poster = template.thumbnail

          // Store template ID
          templateForm.dataset.templateId = templateId

          // Scroll to form
          templateForm.scrollIntoView({ behavior: 'smooth' })
        } catch (error) {
          console.error('Failed to load template details:', error)
        }
      }

      function generateInputFields(inputs) {
        return inputs
          .map((input) => {
            let inputHtml = ''

            switch (input.type) {
              case 'text':
              case 'textarea':
                inputHtml = `
                            <div class="form-group">
                                <label>${input.label}</label>
                                <${input.type === 'textarea' ? 'textarea' : 'input type="text"'} 
                                    name="${input.id}"
                                    placeholder="${input.placeholder || ''}"
                                    ${input.required ? 'required' : ''}
                                ></${input.type === 'textarea' ? 'textarea' : 'input'}>
                                ${input.hint ? `<div class="hint">${input.hint}</div>` : ''}
                            </div>`
                break

              case 'image':
                inputHtml = `
                            <div class="form-group">
                                <label>${input.label}</label>
                                <input type="file" 
                                       name="${input.id}" 
                                       accept="image/*"
                                       ${input.required ? 'required' : ''}>
                                ${input.hint ? `<div class="hint">${input.hint}</div>` : ''}
                                <div style="margin-top: 10px; text-align: center;" id="${input.id}Preview"></div>
                            </div>`
                break

              case 'select':
                inputHtml = `
                            <div class="form-group">
                                <label>${input.label}</label>
                                <select name="${input.id}" ${input.required ? 'required' : ''}>
                                    ${input.options
                                      .map(
                                        (opt) =>
                                          `<option value="${opt.value}">${opt.label}</option>`
                                      )
                                      .join('')}
                                </select>
                                ${input.hint ? `<div class="hint">${input.hint}</div>` : ''}
                            </div>`
                break
            }

            return inputHtml
          })
          .join('')
      }

      async function handleTemplateSubmit(e) {
        e.preventDefault()

        const form = e.target
        const templateId = form.dataset.templateId
        const formData = new FormData(form)

        showLoading('templateLoading')

        try {
          // Convert file inputs to base64
          const inputs = {}
          for (let [key, value] of formData.entries()) {
            if (value instanceof File && value.size > 0) {
              inputs[key] = await fileToBase64(value)
            } else {
              inputs[key] = value
            }
          }

          const data = {
            templateId,
            inputs,
            resolution: formData.get('resolution'),
            priority: formData.get('priority'),
          }

          const response = await fetch(`${API_BASE}/api/video-template`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data),
          })

          const result = await response.json()
          hideLoading('templateLoading')
          showResult('templateResult', result, response.ok)

          // Start polling if task was created
          if (response.ok && result.task_id) {
            pollJobStatus(result.task_id, 'templateResult')
          }
        } catch (error) {
          hideLoading('templateLoading')
          showResult('templateResult', { error: error.message }, false)
        }
      }

      // Helper function to convert image file to base64
      function fileToBase64(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader()
          reader.onload = () => resolve(reader.result)
          reader.onerror = reject
          reader.readAsDataURL(file)
        })
      }

      // Image preview helper
      function showImagePreview(file, previewElementId) {
        const preview = document.getElementById(previewElementId)
        const reader = new FileReader()
        reader.onload = (e) => {
          preview.innerHTML = `<img src="${e.target.result}" style="max-width: 300px; max-height: 200px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">`
        }
        reader.readAsDataURL(file)
      }

      // Setup file input handlers for Image to Video
      document.getElementById('i2vImageFile').addEventListener('change', (e) => {
        if (e.target.files[0]) {
          showImagePreview(e.target.files[0], 'i2vPreview')
          document.getElementById('i2vImage').value = '' // Clear URL input
        }
      })

      // Setup file input handlers for Start & End
      document.getElementById('startImageFile').addEventListener('change', (e) => {
        if (e.target.files[0]) {
          showImagePreview(e.target.files[0], 'startPreview')
          document.getElementById('startImage').value = '' // Clear URL input
        }
      })

      document.getElementById('endImageFile').addEventListener('change', (e) => {
        if (e.target.files[0]) {
          showImagePreview(e.target.files[0], 'endPreview')
          document.getElementById('endImage').value = '' // Clear URL input
        }
      })

      function switchTab(e, tabName) {
        // Prevent default button behavior
        e.preventDefault()

        // Hide all tabs
        const tabContents = document.querySelectorAll('.tab-content')
        const tabs = document.querySelectorAll('.tab')

        tabContents.forEach((content) => {
          content.style.display = 'none'
          content.classList.remove('active')
        })

        tabs.forEach((tab) => {
          tab.classList.remove('active')
        })

        // Show selected tab
        const selectedTab = document.getElementById(tabName)
        if (selectedTab) {
          selectedTab.style.display = 'block'
          selectedTab.classList.add('active')
          e.currentTarget.classList.add('active')
        } else {
          console.error(`Tab with id '${tabName}' not found`)
        }
      }
      function showResult(elementId, data, success = true) {
        const resultDiv = document.getElementById(elementId)
        const alertClass = success ? 'alert-success' : 'alert-error'
        const icon = success ? '✅' : '❌'

        let html = `<div class="alert ${alertClass}">
                <strong>${icon} ${success ? 'Запрос успешен!' : 'Ошибка!'}</strong>
            </div>`

        if (success && data.task_id) {
          html += `
                    <div class="alert alert-info">
                        <strong>🎯 Task ID:</strong> ${data.task_id}<br>
                        <strong>⏱️ Статус:</strong> Видео генерируется... Результат придет на callback.<br>
                        <strong>📁 Сохранится в:</strong> ./out/
                    </div>
                `
        }

        // Show video player if public_url is available
        if (data.public_url) {
          html += `
                    <div style="margin-top: 20px;">
                        <h3>🎬 Готовое видео:</h3>
                        <video controls style="width:100%; max-width:800px; margin-top:12px; border-radius:8px;" src="${data.public_url}"></video>
                    </div>
                `
        }

        html += '<h3>Ответ сервера:</h3>'
        html += `<pre>${JSON.stringify(data, null, 2)}</pre>`

        resultDiv.innerHTML = html
        resultDiv.classList.add('show')
      }

      function hideLoading(loadingId) {
        document.getElementById(loadingId).classList.remove('show')
      }

      function showLoading(loadingId) {
        document.getElementById(loadingId).classList.add('show')
      }

      // Poll job status until completion
      async function pollJobStatus(taskId, resultElementId) {
        const pollInterval = 3000 // 3 seconds
        const maxAttempts = 200 // 10 minutes max (200 * 3s)
        let attempts = 0

        const poll = async () => {
          try {
            const response = await fetch(`${API_BASE}/api/job/${taskId}`)
            const job = await response.json()

            attempts++

            // Update UI with current status
            const resultDiv = document.getElementById(resultElementId)
            const statusInfo = resultDiv.querySelector('.alert-info')

            if (statusInfo) {
              let statusText = '⏱️ Статус: '
              if (job.status === 'processing') {
                statusText += `Обработка... (попытка ${attempts}/${maxAttempts})`
              } else if (job.status === 'success') {
                statusText += '✅ Готово!'
              } else if (job.status === 'failed') {
                statusText += '❌ Ошибка'
              } else {
                statusText += 'Ожидание...'
              }

              // Update status line
              const lines = statusInfo.innerHTML.split('<br>')
              lines[1] = `<strong>${statusText}</strong>`
              statusInfo.innerHTML = lines.join('<br>')
            }

            // Check if completed
            if (job.status === 'success' || job.status === 'failed') {
              showResult(resultElementId, job, job.status === 'success')
              return
            }

            // Continue polling if not max attempts
            if (attempts < maxAttempts) {
              setTimeout(poll, pollInterval)
            } else {
              console.log('Max polling attempts reached')
            }
          } catch (error) {
            console.error('Polling error:', error)
            if (attempts < maxAttempts) {
              setTimeout(poll, pollInterval)
            }
          }
        }

        // Start polling
        setTimeout(poll, pollInterval)
      }

      // Text to Video form
      document.getElementById('t2vForm').addEventListener('submit', async (e) => {
        e.preventDefault()
        const formData = new FormData(e.target)
        const data = {
          prompt: formData.get('prompt'),
          duration: parseInt(formData.get('duration')),
          resolution: formData.get('resolution'),
          aspect_ratio: formData.get('aspect_ratio'),
          model: 'MiniMax-Hailuo-02',
        }

        showLoading('t2vLoading')

        try {
          const response = await fetch(`${API_BASE}/api/generate-text-video`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data),
          })

          const result = await response.json()
          hideLoading('t2vLoading')
          showResult('t2vResult', result, response.ok)

          // Start polling for job status if task was created
          if (response.ok && result.task_id) {
            pollJobStatus(result.task_id, 't2vResult')
          }
        } catch (error) {
          hideLoading('t2vLoading')
          showResult('t2vResult', { error: error.message }, false)
        }
      })

      // Image to Video form
      document.getElementById('i2vForm').addEventListener('submit', async (e) => {
        e.preventDefault()
        const formData = new FormData(e.target)

        showLoading('i2vLoading')

        try {
          // Check if file or URL is provided
          const fileInput = document.getElementById('i2vImageFile')
          let imageSource

          if (fileInput.files[0]) {
            // Convert file to base64
            imageSource = await fileToBase64(fileInput.files[0])
          } else {
            // Use URL
            imageSource = document.getElementById('i2vImage').value
          }

          if (!imageSource) {
            throw new Error('Выберите изображение или укажите URL')
          }

          const data = {
            first_frame_image: imageSource,
            prompt: formData.get('prompt'),
            duration: parseInt(formData.get('duration')),
            resolution: formData.get('resolution'),
            aspect_ratio: formData.get('aspect_ratio'),
            model: 'MiniMax-Hailuo-02',
          }

          const response = await fetch(`${API_BASE}/api/generate-image-video`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data),
          })

          const result = await response.json()
          hideLoading('i2vLoading')
          showResult('i2vResult', result, response.ok)

          // Start polling for job status if task was created
          if (response.ok && result.task_id) {
            pollJobStatus(result.task_id, 'i2vResult')
          }
        } catch (error) {
          hideLoading('i2vLoading')
          showResult('i2vResult', { error: error.message }, false)
        }
      })

      // Start & End form
      document.getElementById('startEndForm').addEventListener('submit', async (e) => {
        e.preventDefault()
        const formData = new FormData(e.target)

        showLoading('startEndLoading')

        try {
          // Get first frame (file or URL)
          const startFileInput = document.getElementById('startImageFile')
          let startImageSource

          if (startFileInput.files[0]) {
            startImageSource = await fileToBase64(startFileInput.files[0])
          } else {
            startImageSource = document.getElementById('startImage').value
          }

          // Get last frame (file or URL)
          const endFileInput = document.getElementById('endImageFile')
          let endImageSource

          if (endFileInput.files[0]) {
            endImageSource = await fileToBase64(endFileInput.files[0])
          } else {
            endImageSource = document.getElementById('endImage').value
          }

          if (!startImageSource || !endImageSource) {
            throw new Error('Выберите оба изображения или укажите их URL')
          }

          const data = {
            first_frame_image: startImageSource,
            last_frame_image: endImageSource,
            prompt: formData.get('prompt'),
            duration: parseInt(formData.get('duration')),
            resolution: formData.get('resolution'),
            aspect_ratio: formData.get('aspect_ratio'),
            model: 'MiniMax-Hailuo-02',
          }

          const response = await fetch(`${API_BASE}/api/generate-start-end-video`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data),
          })

          const result = await response.json()
          hideLoading('startEndLoading')
          showResult('startEndResult', result, response.ok)

          // Start polling for job status if task was created
          if (response.ok && result.task_id) {
            pollJobStatus(result.task_id, 'startEndResult')
          }
        } catch (error) {
          hideLoading('startEndLoading')
          showResult('startEndResult', { error: error.message }, false)
        }
      })

      // Text to Image form
      document.getElementById('t2iForm').addEventListener('submit', async (e) => {
        e.preventDefault()
        const formData = new FormData(e.target)

        const data = {
          prompt: formData.get('prompt'),
          aspect_ratio: formData.get('aspect_ratio'),
          n: parseInt(formData.get('n')),
          prompt_optimizer: formData.get('prompt_optimizer') === 'true',
          model: 'image-01',
          response_format: 'url',
        }

        // Add seed if provided
        const seed = formData.get('seed')
        if (seed && seed.trim() !== '') {
          data.seed = parseInt(seed)
        }

        showLoading('t2iLoading')

        try {
          const response = await fetch(`${API_BASE}/api/generate-image`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data),
          })

          const result = await response.json()
          hideLoading('t2iLoading')

          // Show result with images
          showImageResult('t2iResult', result, response.ok)
        } catch (error) {
          hideLoading('t2iLoading')

          // Try to parse error message for better display
          let errorMessage = error.message
          try {
            const errorData = JSON.parse(error.message)
            if (errorData.error) errorMessage = errorData.error
          } catch (e) {
            // Keep original error message
          }

          showResult(
            't2iResult',
            {
              error: errorMessage,
              hint: 'Проверьте консоль сервера для подробностей. Возможные причины: неверный API ключ, нет доступа к image generation, или проблемы с балансом.',
            },
            false
          )
        }
      })

      // Special result display for images
      function showImageResult(elementId, data, success = true) {
        const resultDiv = document.getElementById(elementId)
        const alertClass = success ? 'alert-success' : 'alert-error'
        const icon = success ? '✅' : '❌'

        let html = `<div class="alert ${alertClass}">
                <strong>${icon} ${success ? 'Изображения сгенерированы!' : 'Ошибка!'}</strong>
            </div>`

        // Display images if available
        if (success && data.data && data.data.image_urls) {
          const imageUrls = data.data.image_urls
          const metadata = data.metadata || {}

          html += `
                    <div class="alert alert-info">
                        <strong>📊 Статистика:</strong><br>
                        <strong>✅ Успешно:</strong> ${metadata.success_count || imageUrls.length}<br>
                        <strong>❌ Заблокировано:</strong> ${metadata.failed_count || 0}<br>
                        <strong>🆔 Trace ID:</strong> ${data.id || 'N/A'}
                    </div>
                `

          html += `<div style="margin-top: 20px;">
                    <h3>🖼️ Сгенерированные изображения:</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin-top: 15px;">`

          imageUrls.forEach((url, index) => {
            html += `
                        <div style="border: 2px solid #e0e0e0; border-radius: 8px; overflow: hidden;">
                            <img src="${url}" style="width: 100%; display: block;" alt="Generated image ${index + 1}">
                            <div style="padding: 10px; background: #f8f9fa; text-align: center;">
                                <a href="${url}" target="_blank" class="btn" style="width: auto; padding: 8px 16px; font-size: 14px; margin-top: 0;">
                                    📥 Скачать изображение ${index + 1}
                                </a>
                            </div>
                        </div>
                    `
          })

          html += `</div></div>`
        }

        html += '<h3>Ответ сервера:</h3>'
        html += `<pre>${JSON.stringify(data, null, 2)}</pre>`

        resultDiv.innerHTML = html
        resultDiv.classList.add('show')
      }

      // Quick Demo buttons
      async function runDemo(type) {
        showLoading('demoLoading')

        try {
          const response = await fetch(`${API_BASE}/demo/${type}`)
          const result = await response.json()
          hideLoading('demoLoading')

          // Use special image result for t2i
          if (type === 't2i') {
            showImageResult('demoResult', result, response.ok)
          } else {
            showResult('demoResult', result, response.ok)

            // Start polling for job status if task was created (videos only)
            if (response.ok && result.task_id) {
              pollJobStatus(result.task_id, 'demoResult')
            }
          }
        } catch (error) {
          hideLoading('demoLoading')
          showResult('demoResult', { error: error.message }, false)
        }
      }
    </script>
  </body>
</html>
